<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="William Vaughn">
  <link rel="canonical" href="https://nackjicholson.github.io/aiosql/getting-started/">
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Getting Started - aiosql docs</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../css/theme.css" />
  <link rel="stylesheet" href="../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  <link href="../css/custom.css" rel="stylesheet" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "Getting Started";
    var mkdocs_page_input_path = "getting-started.md";
    var mkdocs_page_url = "/aiosql/getting-started/";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> aiosql docs</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                    </li>
                </ul>
                <ul class="current">
                    <li class="toctree-l1 current"><a class="reference internal current" href="./">Getting Started</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#philosophy">Philosophy</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#about-orms">About ORMs</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#loading-queries">Loading Queries</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#from-a-sql-file">From a SQL File</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#from-a-sql-string">From a SQL String</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#from-a-directory-of-sql-files">From a Directory of SQL Files</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#subdirectories">Subdirectories</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#calling-query-methods">Calling Query Methods</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#connections">Connections</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#passing-parameters">Passing Parameters</a>
    </li>
        </ul>
    </li>
    </ul>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../defining-sql-queries/">Defining SQL Queries</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../advanced-topics/">Advanced Topics</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../database-driver-adapters/">Database Driver Adapters</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../api/">API</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">aiosql docs</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>Getting Started</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/nackjicholson/aiosql/edit/master/docs/getting-started.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="getting-started">Getting Started<a class="headerlink" href="#getting-started" title="Permanent link">&para;</a></h1>
<h2 id="philosophy">Philosophy<a class="headerlink" href="#philosophy" title="Permanent link">&para;</a></h2>
<p>The aiosql project is for writing SQL to interact with a database. Most database libraries are intended to reduce the amount of SQL developers need to write, aiosql takes an alternative approach. Why?</p>
<ul>
<li>Alternatives are good. No approach fits all use cases, no matter how predominant.</li>
<li>SQL is the most expressive and performant way to interact with a SQL database.</li>
<li>Investigating where a query came from is simpler when it is source controlled, named, and written by a human.</li>
<li>Writing SQL in files gives you built-in compatibility with powerful SQL tools like <a href="https://www.jetbrains.com/datagrip/">DataGrip</a> and <a href="https://www.postgresql.org/docs/12/app-psql.html">psql</a>.</li>
</ul>
<h3 id="about-orms">About ORMs<a class="headerlink" href="#about-orms" title="Permanent link">&para;</a></h3>
<p>ORMs and SQL Query Builders offer object interfaces to generate and execute SQL. They exist to ease development, not to make it simpler. Inheriting object hierarchies, mixing data with behaviors, mirroring a database schema, and generating SQL are not simple. ORMs are introduced early in a project's life when requirements are limited and the need to move fast is paramount. As a project grows, ORM objects and their relations grow too, they become a source of complexity and coupling.</p>
<p>aiosql doesn't solve these problems directly either, your application will still get more complex with time. You can write bad SQL and bad python. But, with aiosql there is no mandate that all interaction with the database go through a complex network of related python objects that mirror a database schema. The only mandates are that you write SQL to talk to the database and python to use the data. From there you start with a system in which the database and the application are intentionally separate and independent from each other so they can change independently. The architecture of your application and the boundaries you choose between it and the database is left to you.</p>
<p>The documentation for projects like <a href="https://www.sqlalchemy.org/">SQLAlchemy</a> and <a href="https://docs.djangoproject.com/en/3.0/topics/db/">Django DB</a> can give you a better vision for the class of problems that ORMs do solve and the productivity gains they intend. Please choose these projects over aiosql if you find that they fit the needs of your application better.</p>
<h2 id="loading-queries">Loading Queries<a class="headerlink" href="#loading-queries" title="Permanent link">&para;</a></h2>
<p>This section goes over the three ways to make SQL queries available for execution in python. You'll learn the basics of defining queries so aiosql can find them and turn them into methods on a <code>Queries</code> object. For more details reference the <a href="../defining-sql-queries/">Defining SQL Queries</a> documentation.</p>
<h3 id="from-a-sql-file">From a SQL File<a class="headerlink" href="#from-a-sql-file" title="Permanent link">&para;</a></h3>
<p>SQL can be loaded by providing a path to a <code>.sql</code> file. Below is a <em>blogs.sql</em> file that defines two queries.</p>
<pre><code class="sql">-- name: get_all_blogs
select blogid,
       userid,
       title,
       content,
       published
  from blogs;

-- name: get_user_blogs
-- Get blogs with a fancy formatted published date and author field
    select b.blogid,
           b.title,
           strftime('%Y-%m-%d %H:%M', b.published) as published,
           u.username as author
      from blogs b
inner join users u on b.userid = u.userid
     where u.username = :username
  order by b.published desc;
</code></pre>

<p>Notice the <code>--name: &lt;name_of_method&gt;</code> comments and the <code>:username</code> substitution variable. The comments that start with <code>--name:</code> are the magic of aiosql. They are used by <a href="../api/#aiosqlfrom_path"><code>aiosql.from_path</code></a> to parse the file into separate methods accessible by the name. The <code>aiosql.from_path</code> function takes a path to a sql file or directory and the name of the database driver intended for use with the methods. </p>
<pre><code class="python">queries = aiosql.from_path(&quot;blogs.sql&quot;, &quot;sqlite3&quot;)
</code></pre>

<p>In the case of <em>blogs.sql</em> we expect the following two methods to be available. The <code>username</code> parameter of <code>get_user_blogs</code> will substitute in for the <code>:username</code> variable in the SQL.</p>
<pre><code class="python">def get_all_blogs(self) -&gt; List:
    pass

def get_user_blogs(self, username: str) -&gt; List:
    pass
</code></pre>

<h3 id="from-a-sql-string">From a SQL String<a class="headerlink" href="#from-a-sql-string" title="Permanent link">&para;</a></h3>
<p>SQL can be loaded from a string as well. The result below is the same as the first example above that loads from a SQL file.</p>
<pre><code class="python">sql_str = &quot;&quot;&quot;
-- name: get_all_blogs
select blogid,
       userid,
       title,
       content,
       published
  from blogs;

-- name: get_user_blogs
-- Get blogs with a fancy formatted published date and author field
    select b.blogid,
           b.title,
           strftime('%Y-%m-%d %H:%M', b.published) as published,
           u.username as author
      from blogs b
inner join users u on b.userid = u.userid
     where u.username = :username
  order by b.published desc;
&quot;&quot;&quot;

queries = aiosql.from_str(sql_str, &quot;sqlite3&quot;)
</code></pre>

<p>The <code>Queries</code> object here will have two methods:</p>
<pre><code class="python">queries.get_all_blogs(conn)
queries.get_user_blogs(conn, username=&quot;johndoe&quot;)
</code></pre>

<h3 id="from-a-directory-of-sql-files">From a Directory of SQL Files<a class="headerlink" href="#from-a-directory-of-sql-files" title="Permanent link">&para;</a></h3>
<p>Loading a directory of SQL files loads all of the queries defined in those files into a single object. The <code>example/sql</code> directory below contains three <code>.sql</code> files and can be loaded using <a href="../api/#aiosqlfrom_path"><code>aiosql.from_path</code></a>.</p>
<pre><code>example/sql
├── blogs.sql
├── create_schema.sql
└── users.sql
</code></pre>

<pre><code class="python">queries = aiosql.from_path(&quot;example/sql&quot;, &quot;sqlite3&quot;)
</code></pre>

<p>The resulting <code>queries</code> object will have a mixture of methods from all the files.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Don't name queries the same in various files in the same directory. The last one loaded will win. See <a href="./#subdirectories">Subdirectories</a> below to namespace queries.</p>
</div>
<h4 id="subdirectories">Subdirectories<a class="headerlink" href="#subdirectories" title="Permanent link">&para;</a></h4>
<p>Introducing subdirectories allows namspacing queries. This provides a way to further organize and group queries conceptually. For instance, you could define blog queries separate from user queries access them on distinct properties of the queries object.</p>
<p>Assume the <em>blogs.sql</em> and <em>users.sql</em> files both contain a <code>--name: get_all</code> query.</p>
<pre><code>example/sql
├── blogs
│   └── blogs.sql
├── create_schema.sql
└── users
    └── users.sql
</code></pre>

<pre><code class="python">queries = aiosql.from_path(&quot;example/sql&quot;, &quot;sqlite3&quot;)
</code></pre>

<p>The <code>Queries</code> object has two nested <code>get_all</code> methods accessible on attributes <code>.blogs</code> and <code>.users</code>. The attributes reflect the names of the subdirectories.</p>
<pre><code class="python">queries.blogs.get_all(conn)
queries.users.get_all(conn)
</code></pre>

<h2 id="calling-query-methods">Calling Query Methods<a class="headerlink" href="#calling-query-methods" title="Permanent link">&para;</a></h2>
<h3 id="connections">Connections<a class="headerlink" href="#connections" title="Permanent link">&para;</a></h3>
<p>The connection or <code>conn</code> is always the first argument to an aiosql method. The <code>conn</code> is an open connection to a database driver that your aiosql method can use for executing the sql it contains. Controlling connections outside of aiosql queries means you can call multiple queries and control them under one transaction, or otherwise set connection level properties that affect driver behavior. </p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For more see: <a href="../advanced-topics/#leveraging-driver-specific-features">Leveraging Driver Specific Features</a>.</p>
</div>
<p>In the examples throughout this page a <code>conn</code> object has been passed. Here is a more code complete example that shows the connection creation and call to <a href="../api/#aiosqlfrom_path"><code>aiosql.from_path</code></a> that make a queries object.</p>
<pre><code class="python">&gt;&gt;&gt; import sqlite3
&gt;&gt;&gt; import aiosql
&gt;&gt;&gt; conn = sqlite3.connect(&quot;./mydb.sql&quot;)
&gt;&gt;&gt; # Note the &quot;sqlite3&quot; driver_adapter argument is what tells 
&gt;&gt;&gt; # aiosql it should be expecting a sqlite3 connection object.
&gt;&gt;&gt; queries = aiosql.from_path(&quot;./blogs.sql&quot;, &quot;sqlite3&quot;)
&gt;&gt;&gt; queries.get_all_blogs(conn)
[(1,
  1,
  'What I did Today',
  'I mowed the lawn, washed some clothes, and ate a burger.\n'
  '\n'
  'Until next time,\n'
  'Bob',
  '2017-07-28'),
 (2, 3, 'Testing', 'Is this thing on?\n', '2018-01-01'),
 (3,
  1,
  'How to make a pie.',
  '1. Make crust\n2. Fill\n3. Bake\n4. Eat\n',
  '2018-11-23')]
</code></pre>

<h3 id="passing-parameters">Passing Parameters<a class="headerlink" href="#passing-parameters" title="Permanent link">&para;</a></h3>
<pre><code class="sql">-- name: get_user_blogs
-- Get blogs with a fancy formatted published date and author field
    select b.blogid,
           b.title,
           strftime('%Y-%m-%d %H:%M', b.published) as published,
           u.username as author
      from blogs b
inner join users u on b.userid = u.userid
     where u.username = :username
  order by b.published desc;
</code></pre>

<p>aiosql allows paremeterization of queries by parsing values like <code>:username</code> in the above query and having the resultant method expect an inbound argument to substitute for <code>:username</code>.</p>
<p>You can call the <code>get_user_blogs</code> function with plain arguments or keyword arguments with the name of the subsitution variable.</p>
<pre><code class="python">&gt;&gt;&gt; import sqlite3
&gt;&gt;&gt; import aiosql
&gt;&gt;&gt; conn = sqlite3.connect(&quot;./mydb.sql&quot;)
&gt;&gt;&gt; queries = aiosql.from_path(&quot;./blogs.sql&quot;, &quot;sqlite3&quot;)
&gt;&gt;&gt;
&gt;&gt;&gt; # Using keyword args
&gt;&gt;&gt; queries.get_user_blogs(conn, username=&quot;bobsmith&quot;)
[(3, 'How to make a pie.', '2018-11-23 00:00', 'bobsmith'), (1, 'What I did Today', '2017-07-28 00:00', 'bobsmith')]
&gt;&gt;&gt;
&gt;&gt;&gt; # Using positional argument
&gt;&gt;&gt; queries.get_user_blogs(conn, &quot;janedoe&quot;)
[(2, 'Testing', '2018-01-01 00:00', 'janedoe')]
</code></pre>

<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>When passing positional arguments aiosql will apply them in the order that the substitutions appear in your SQL. This can be convenient and clear in some cases, but confusing in others. You might want to choose to always name your arguments for clarity.</p>
</div>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../defining-sql-queries/" class="btn btn-neutral float-right" title="Defining SQL Queries">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href=".." class="btn btn-neutral" title="Home"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
      <p>Copyright 2018-2020, William Vaughn</p>
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/nackjicholson/aiosql/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href=".." style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../defining-sql-queries/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
